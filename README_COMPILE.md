# ç¼–è¯‘æŒ‡å— - å¿«é€Ÿå¼€å§‹

## ğŸ¯ é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### ä¹‹å‰çš„é—®é¢˜
ä½ çš„ GitHub Actions ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š
```
é”™è¯¯ï¼šå‘½ä»¤"åŒæ­¥"éœ€è¦å…ˆå®‰è£…ä»“åº“ã€‚
âŒ AOSPåŒæ­¥å¤±è´¥ï¼šæ‰¾ä¸åˆ°æ„å»º/envsetup.sh
```

### æ ¹æœ¬åŸå› 
- repo å·¥å…·å®‰è£…åæ²¡æœ‰éªŒè¯
- PATH ç¯å¢ƒå˜é‡æ²¡æœ‰æ­£ç¡®ä¼ é€’
- ç¼ºå°‘è¯¦ç»†çš„é”™è¯¯æ£€æµ‹

### è§£å†³æ–¹æ¡ˆ
å·²åˆ›å»º **3 ä¸ªå®Œæ•´çš„ç¼–è¯‘è„šæœ¬**ï¼Œä¿®å¤äº†æ‰€æœ‰é—®é¢˜ã€‚

---

## ğŸ“‹ ç¼–è¯‘æ–¹å¼é€‰æ‹©

### æ–¹å¼ 1ï¸âƒ£: GitHub Actionsï¼ˆâ­ æ¨èé¦–é€‰ï¼‰

**æœ€ç®€å•ï¼Œé€‚åˆå¤§å¤šæ•°äºº**

```bash
# 1. ä¿®æ”¹ä»£ç ï¼ˆå¯é€‰ï¼‰
vim daemon/main.cpp

# 2. æäº¤å¹¶æ¨é€
git add .
git commit -m "æ”¹è¿› ADB"
git push origin main

# 3. æŸ¥çœ‹ç¼–è¯‘ç»“æœ
# è¿›å…¥ GitHub â†’ Actions æ ‡ç­¾ â†’ æŸ¥çœ‹æœ€æ–°çš„ workflow run
# ç¼–è¯‘å®Œæˆåè‡ªåŠ¨åˆ›å»º Releaseï¼ˆçº¦ 1-2 å°æ—¶ï¼‰
```

**ç‰¹ç‚¹**:
- âœ“ æ— éœ€æœ¬åœ°é…ç½®
- âœ“ è‡ªåŠ¨ä¸Šä¼  Release
- âœ“ æ—¥å¿—å®Œæ•´å¯æŸ¥
- âœ“ è‡ªåŠ¨é‡è¯•æœºåˆ¶

---

### æ–¹å¼ 2ï¸âƒ£: æœ¬åœ°ç¼–è¯‘ï¼ˆDockerï¼‰

**éœ€è¦ Dockerï¼Œæœ€ç¨³å®š**

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/adb

# 2. è¿è¡Œç¼–è¯‘è„šæœ¬
bash build_adb_improved.sh

# 3. ç­‰å¾…å®Œæˆï¼ˆ1-2 å°æ—¶ï¼‰
# è¾“å‡º: ./adbd_arm64
```

**å‰ç½®è¦æ±‚**:
- Linux / macOS / WSL2
- Dockerï¼ˆå¯é€‰ï¼Œæœ¬è„šæœ¬æ— éœ€ Dockerï¼‰
- 100GB+ ç£ç›˜ç©ºé—´

**ç‰¹ç‚¹**:
- âœ“ å®Œå…¨æœ¬åœ°è¿è¡Œ
- âœ“ å®æ—¶è¿›åº¦æ˜¾ç¤º
- âœ“ è¯¦ç»†çš„é”™è¯¯æ£€æµ‹
- âœ“ è‡ªåŠ¨é‡è¯• 3 æ¬¡

---

### æ–¹å¼ 3ï¸âƒ£: æœ¬åœ°ç¼–è¯‘ï¼ˆç›´æ¥ï¼‰

**æœ€çµæ´»ï¼Œé€‚åˆé¢‘ç¹å¼€å‘**

```bash
# ä½¿ç”¨æ”¹è¿›ç‰ˆè„šæœ¬
bash build_adb_improved.sh
```

**å‰ç½®è¦æ±‚**:
```bash
# Ubuntu/Debian
sudo apt-get install -y \
  openjdk-11-jdk \
  git curl python3 python3-dev \
  build-essential libssl-dev bc bison flex

# å®‰è£… repo
mkdir -p ~/bin
curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
chmod a+x ~/bin/repo
export PATH="$HOME/bin:$PATH"
```

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨ï¼ˆæ¨è GitHub Actionsï¼‰

### ç¬¬ 1 æ­¥ï¼šä¿®æ”¹ä»£ç 

```bash
cd /path/to/adb

# ç¼–è¾‘ä»£ç 
vim daemon/main.cpp

# æˆ–ä½¿ç”¨ IDE ä¿®æ”¹
```

### ç¬¬ 2 æ­¥ï¼šæäº¤

```bash
git add .
git commit -m "æ”¹è¿› ADB daemon"
git push origin main
```

### ç¬¬ 3 æ­¥ï¼šæŸ¥çœ‹ç¼–è¯‘

1. æ‰“å¼€ GitHub ä»“åº“
2. ç‚¹å‡» "Actions" æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°çš„ "Build ADB ARM64 (Stable)"
4. ç‚¹å‡»è¿›å»æŸ¥çœ‹å®æ—¶æ—¥å¿—

### ç¬¬ 4 æ­¥ï¼šä¸‹è½½ç»“æœ

ç¼–è¯‘å®Œæˆåï¼š
1. è¿›å…¥ "Releases" æ ‡ç­¾
2. ä¸‹è½½æœ€æ–°çš„ `v{number}` Release ä¸­çš„ `adbd_arm64`
3. æˆ–ç›´æ¥åœ¨ Actions é¡µé¢ä¸‹è½½ Artifacts

---

## âš™ï¸ æœ¬åœ°ç¼–è¯‘è¯¦ç»†æ­¥éª¤

### ä½¿ç”¨æ”¹è¿›è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
bash build_adb_improved.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ“ æ£€æŸ¥ç³»ç»Ÿå·¥å…·ï¼ˆgit, java, python, gccï¼‰
2. âœ“ å®‰è£… repo å·¥å…·ï¼ˆå¦‚éœ€è¦ï¼‰
3. âœ“ æ£€æŸ¥ç£ç›˜ç©ºé—´
4. âœ“ åˆå§‹åŒ– AOSP
5. âœ“ åŒæ­¥æºç ï¼ˆ3 æ¬¡é‡è¯•ï¼‰
6. âœ“ å¤åˆ¶ä¿®æ”¹çš„ ADB
7. âœ“ ç¼–è¯‘ adbd
8. âœ“ æå–äºŒè¿›åˆ¶

**è¾“å‡º**:
```
âœ“ ç¼–è¯‘å®Œæˆï¼
è¾“å‡ºæ–‡ä»¶: ./adbd_arm64
æ–‡ä»¶å¤§å°: 18MB
```

### ç¼–è¯‘è¿›åº¦

```
==> æ£€æŸ¥ç³»ç»Ÿå·¥å…·          (2 min)
==> åˆå§‹åŒ– AOSP          (3 min)
==> åŒæ­¥ AOSP æºç        (30-60 min) â† æœ€é•¿
==> å¤åˆ¶ ADB ä»£ç         (1 min)
==> ç¼–è¯‘ adbd            (10-20 min)
==> æå–äºŒè¿›åˆ¶           (1 min)
```

**æ€»è€—æ—¶: 45åˆ†é’Ÿ ~ 2å°æ—¶**ï¼ˆå–å†³äºç½‘ç»œï¼‰

---

## ğŸ” æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| **build_adb_improved.sh** | æœ¬åœ°ç¼–è¯‘è„šæœ¬ï¼ˆæ¨èï¼‰ |
| **.github/workflows/build.yml** | GitHub Actionsï¼ˆå·²ä¿®å¤ï¼‰ |
| **BUILD_GUIDE.md** | å®Œæ•´ç¼–è¯‘æŒ‡å— |
| **QUICKSTART.md** | å¿«é€Ÿå‚è€ƒ |
| **build.config** | ç¼–è¯‘å‚æ•°é…ç½® |

---

## ğŸ› æ•…éšœæ’æŸ¥

### GitHub Actions ç¼–è¯‘å¤±è´¥

**ç—‡çŠ¶**: ç¼–è¯‘å¡åœ¨ "Syncing AOSP sources"

**åŸå› **: ç½‘ç»œè¶…æ—¶æˆ–ä¸ç¨³å®š

**è§£å†³**:
1. æŸ¥çœ‹å®Œæ•´æ—¥å¿—ï¼ˆä¸è¦çœ‹æ‘˜è¦ï¼‰
2. è„šæœ¬å·²å†…ç½® 3 æ¬¡è‡ªåŠ¨é‡è¯•
3. è€å¿ƒç­‰å¾…ï¼ˆrepo sync å¯èƒ½éœ€è¦ 1 å°æ—¶ï¼‰
4. å¦‚æœå…¨éƒ¨å¤±è´¥ï¼Œé‡æ–° pushï¼š`git push origin main`

### æœ¬åœ°ç¼–è¯‘å¤±è´¥

**ç—‡çŠ¶**: `âŒ åŒæ­¥å¤±è´¥ï¼šæ‰¾ä¸åˆ° build/envsetup.sh`

**åŸå› **: repo åŒæ­¥å¤±è´¥

**è§£å†³**:
```bash
# 1. æ£€æŸ¥ç½‘ç»œ
ping android.googlesource.com

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æ¸…ç†åé‡è¯•
rm -rf ~/aosp/.repo
bash build_adb_improved.sh
```

### äºŒè¿›åˆ¶æ— æ³•æ¨é€

**ç—‡çŠ¶**: `adb push adbd_arm64 /system/bin/adbd` å¤±è´¥

**è§£å†³**:
```bash
# 1. ç¡®ä¿è®¾å¤‡å·²è¿æ¥
adb devices

# 2. æ¨é€åˆ°ä¸´æ—¶ç›®å½•å…ˆæµ‹è¯•
adb push adbd_arm64 /data/local/tmp/
adb shell /data/local/tmp/adbd_arm64 --version

# 3. å¦‚æœå·¥ä½œï¼Œå†éƒ¨ç½²
adb push adbd_arm64 /system/bin/adbd
adb shell chmod 755 /system/bin/adbd
adb reboot
```

---

## ğŸ“Š ç¼–è¯‘æ—¶é—´å¯¹æ¯”

| é˜¶æ®µ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| **AOSP åŒæ­¥** | 30-60 min | é¦–æ¬¡æœ€é•¿ï¼Œä¹‹ååªæ›´æ–° |
| **ç¼–è¯‘** | 10-20 min | å–å†³äºä»£ç æ”¹åŠ¨é‡ |
| **GitHub Actions** | 1-2 å°æ—¶ | åŒ…æ‹¬æ‰€æœ‰é˜¶æ®µ + ç½‘ç»œå»¶è¿Ÿ |
| **æœ¬åœ°ç¼–è¯‘** | 45 min ~ 2 h | å–å†³äºç½‘ç»œ |
| **å¢é‡ç¼–è¯‘** | 10-30 min | åªæ”¹äº†æºç  |

---

## âœ… éªŒè¯ç¼–è¯‘æˆåŠŸ

### æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶

```bash
# æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯
file adbd_arm64
# åº”è¾“å‡º: ELF 64-bit LSB shared object, ARM aarch64

# æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lh adbd_arm64
# åº”è¾“å‡º: -rwxr-xr-x (15-20MB)

# æŸ¥çœ‹ç¬¦å·
nm adbd_arm64 | grep -i main
# åº”è¾“å‡º: main ç¬¦å·ä¿¡æ¯
```

### åœ¨è®¾å¤‡ä¸ŠéªŒè¯

```bash
# æ¨é€
adb push adbd_arm64 /data/local/tmp/

# éªŒè¯
adb shell file /data/local/tmp/adbd_arm64
# åº”è¾“å‡º: ARM aarch64 ELF

# è¿è¡Œ
adb shell /data/local/tmp/adbd_arm64 --version
# åº”è¾“å‡º: ç‰ˆæœ¬ä¿¡æ¯
```

---

## ğŸ“ æœ€ä½³å®è·µ

### åœºæ™¯ 1: é¦–æ¬¡ç¼–è¯‘

```bash
# æ¨èä½¿ç”¨ GitHub Actions
git push origin main
# ç­‰å¾… 1-2 å°æ—¶
# ä» Releases ä¸‹è½½
```

### åœºæ™¯ 2: é¢‘ç¹ä¿®æ”¹æµ‹è¯•

```bash
# ç¬¬ä¸€æ¬¡ï¼ˆæœ¬åœ°ï¼‰
bash build_adb_improved.sh

# ä¹‹åæ¯æ¬¡ä¿®æ”¹
# ç¼–è¾‘ä»£ç 
vim daemon/main.cpp

# å¢é‡ç¼–è¯‘ï¼ˆå¿«å¾—å¤šï¼‰
cd ~/aosp
source build/envsetup.sh
lunch aosp_arm64-eng
m adbd -j$(nproc)
```

### åœºæ™¯ 3: ç”Ÿäº§å‘å¸ƒ

```bash
# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag v1.0.0
git push origin v1.0.0

# GitHub Actions è‡ªåŠ¨ç¼–è¯‘å¹¶åˆ›å»º Release
# ä» Releases ä¸‹è½½æœ€ç»ˆäº§ç‰©
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£

```bash
cat BUILD_GUIDE.md      # å®Œæ•´æŒ‡å—
cat QUICKSTART.md       # å¿«é€Ÿå‚è€ƒ
cat IMPROVEMENTS.md     # æ”¹è¿›è¯´æ˜
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æœ¬åœ°ç¼–è¯‘æ—¥å¿—
tail -f build.log

# GitHub Actions æ—¥å¿—
# è¿›å…¥ Actions â†’ å…·ä½“ run â†’ å±•å¼€æ¯ä¸ª step
```

### å¸¸è§é—®é¢˜

**Q: ç¼–è¯‘éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ**
A: é¦–æ¬¡ 1-2 å°æ—¶ï¼ˆåŒ…æ‹¬åŒæ­¥ï¼‰ï¼Œä¹‹å 30-45 åˆ†é’Ÿ

**Q: éœ€è¦å¤šå°‘ç£ç›˜ç©ºé—´ï¼Ÿ**
A: è‡³å°‘ 100GBï¼ˆAOSP + è¾“å‡º + ç¼–è¯‘ç¼“å­˜ï¼‰

**Q: å¯ä»¥ä¸­é€”æš‚åœå—ï¼Ÿ**
A: å¯ä»¥ï¼ŒAOSP ä¼šä¿å­˜ï¼Œä¸‹æ¬¡ç»§ç»­ä»ä¸­æ–­å¤„

**Q: æ€ä¹ˆåŠ å¿«ç¼–è¯‘ï¼Ÿ**
A:
1. ç”¨ ccacheï¼š`export USE_CCACHE=1`
2. å¢åŠ çº¿ç¨‹ï¼š`m adbd -j32`ï¼ˆå–å†³äº CPUï¼‰

---

## ğŸ‰ æ€»ç»“

| æ–¹é¢ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| ç¨³å®šæ€§ | âŒ ç»å¸¸å¤±è´¥ | âœ… 3 æ¬¡è‡ªåŠ¨é‡è¯• |
| æ–‡æ¡£ | âŒ ä¸å®Œå–„ | âœ… è¯¦ç»†æŒ‡å— |
| é€‰æ‹© | âŒ åªæœ‰ GA | âœ… ä¸‰ç§æ–¹å¼ |
| æœ¬åœ°ç¼–è¯‘ | âŒ æ—  | âœ… å®Œæ•´è„šæœ¬ |
| é”™è¯¯å¤„ç† | âŒ ç®€é™‹ | âœ… è¯¦ç»†è¯Šæ–­ |

---

## ğŸš€ ç«‹å³å¼€å§‹

### é€‰é¡¹ Aï¼šGitHub Actionsï¼ˆæœ€ç®€å•ï¼‰
```bash
git push origin main
# ç­‰å¾…ç¼–è¯‘å®Œæˆï¼Œä¸‹è½½ Release
```

### é€‰é¡¹ Bï¼šæœ¬åœ°ç¼–è¯‘ï¼ˆæœ€æ§åˆ¶ï¼‰
```bash
bash build_adb_improved.sh
# ç­‰å¾…ç¼–è¯‘å®Œæˆï¼Œå¾—åˆ° adbd_arm64
```

### é€‰é¡¹ Cï¼šæŸ¥çœ‹æ–‡æ¡£
```bash
cat BUILD_GUIDE.md
```

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹å®Œæ•´æ–‡æ¡£æˆ–æ£€æŸ¥æ—¥å¿—ã€‚

**ç¼–è¯‘æˆåŠŸï¼Ÿ** æ¨é€åˆ°è®¾å¤‡äº«å—ä½ çš„ä¿®æ”¹ï¼

---

**æœ€åæ›´æ–°**: 2024-01-11
**ç‰ˆæœ¬**: v2.0 (ä¿®å¤ç‰ˆ)
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
